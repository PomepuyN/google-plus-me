#!/opt/local/bin/perl -w
# huyz 2011-08-12

use autodie qw(:all);

if (@ARGV != 1 || ! -d $ARGV[0]) {
  die "Usage: $0 directory";
}

chdir($ARGV[0]) or die "Can't cd to $ARGV[0]";

use Text::CSV;

my %messages;
my @rows;
my $csv = Text::CSV->new ( { binary => 1, eol => $/ } )  # should set binary attribute.
                or die "Cannot use CSV: ".Text::CSV->error_diag ();


open my $fh, "<:encoding(utf8)", "messages.csv" or die "messages.csv: $!";
while ( my $row = $csv->getline( $fh ) ) {
  if ($row->[0]) {
    $messages{$row->[0]} = $row->[3];
  }
}
$csv->eof or $csv->error_diag();
close $fh;

binmode STDOUT, ":utf8";

print $messages{options_nav_links_desc}, "\n";
print $messages{options_nav_faq_label}, "\n";


if (! -e "messages-gplus.json") {
  system("mv messages.json messages-gplus.json");
}

if (-e "messages.json") {
  die "messages.json already exists";
}
system("cp -f ../en/messages.json messages.json");

